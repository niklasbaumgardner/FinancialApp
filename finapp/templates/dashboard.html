{% extends "base.html" %}

{% block title %}Dashboard{% endblock title %}
{% block dashboard %}active{% endblock dashboard %}

{% block backButton %}<a href="/" class="btn btn-outline-primary me-5"> &#8249; Back</a>{% endblock backButton %}



{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.min.js" integrity="sha512-GMGzUEevhWh8Tc/njS0bDpwgxdCJLQBWG3Z2Ct+JGOpVnEmjvNx6ts4v6A2XJf1HOrtOsfhv3hBKpK9kE5z8AQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.js" integrity="sha512-CWVDkca3f3uAWgDNVzW+W4XJbiC3CH84P2aWZXj+DqI6PNbTzXbl1dIzEHeNJpYSn4B6U8miSZb/hCws7FnUZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/helpers.esm.min.js" integrity="sha512-1b6IKdJzKvjUfXuATUJs0a4ti8sBZHY0DKZ1O1UCj3cpw+IEKxUwG2UtXNOjS5/JkqxQ2v5GUMFn62mtZyXAfA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/dist/chart.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0/helpers/helpers.js"></script> -->

<script>
    function getData(url) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", url, false ); // false for synchronous request
        xmlHttp.send( null );
        return JSON.parse(xmlHttp.response);
    }
    function getPieData() {
        return getData("{{ url_for('home.get_pie_data') }}");
    }
    function getAllBudgetsLineData() {
        return getData("{{ url_for('home.get_all_budgets_line_data') }}");
    }
    function getNetSpending(daysBack=30) {
        var date = new Date();
        var year = date.getFullYear();
        var month = (date.getMonth() + 1).toString().padStart(2, '0');
        var day = date.getDate().toString().padStart(2, '0');
        var strDate = year + '-' + month + '-' + day;
        return getData("{{ url_for('home.get_net_spending') }}" + "?currentDate=" + strDate + "&daysBack=" + daysBack);
    }
</script>

<div class="container py-5 h-100">
    <div class="row h-100 py-12">
        <div class="card bg-dark p-5">
            <div>
                <p class="text-white fs-2">Check the budgets you want to view</p>
                <div id="lineButtons" class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                    <input type="checkbox" class="btn-check" id="allBudgets" checked>
                    <label id="allBudgetsLabel" class="btn btn-outline-light" for="allBudgets">All Budgets</label>
                </div>
                <button class="btn btn-outline-primary" onclick="reAssignColors()">Randomize colors</button>
            </div>
            <div class="card-body">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
    </div>

    <div class="row h-100">
        <div class="col mt-5 py-0 mr-24">
            <div id="pie-chart-div" class="card bg-dark p-5">
                <canvas id="pieChart"></canvas>
            </div>
        </div>
        <div class="col mt-5 py-0 ml-24">
            <div id="" class="card bg-dark p-5">
                <!-- <canvas id="pieChart"></canvas> -->
                <p class="text-white fs-1">More coming soon...</p>
            </div>
        </div>
    </div>

    <div class="row py-5">
        <div class="col">
            <div class="card bg-dark">
                <div class="card-header">
                    <p class="fs-1 text-white">Spending in the last 
                        <select id="spendingDays" class="form-select w-15 inline form-select-lg bg-light-grey" aria-label="Default select example">
                            <option value="7">7 days</option>
                            <option value="30" selected>30 days</option>
                            <option value="60">60 days</option>
                            <option value="90">90 days</option>
                            <option value="">All time</option>
                        </select>
                    </p>
                </div>
                <div class="m-5" id="net-spending">
                </div>
            </div>
        </div>

    </div>
<script src="/static/js/dashboard.js"></script>
<script>
    document.getElementById('spendingDays').addEventListener('change', (event) => {
        console.log(event.target.value);
        netSpending(event.target.value);
    });
</script>
{% endblock content %}
